<% if @statuses.empty? or rows.empty? %>
    <p><i><%=l(:label_no_data)%></i></p>
<% else %>
<table class="list issue-report">
<thead><tr>
<th></th>
<th><strong>작성한 댓글 수</strong></th>
</tr></thead>
<tbody>
<% for row in rows %>
<tr>
  <td class="name"><%= link_to row.name, aggregate_path(@project, field_name, row, :subproject_id => nil) %></td>
  <td><%= notes_author_aggregate_link data, { field_name => row.id } %></td>
</tr>
<% end %>
</tbody>
</table>
<div class="issue-report-graph hide-when-print">
  <canvas id="issues_by_<%= params[:detail] %>"></canvas>
</div>
<%= javascript_tag do %>
  function renderChart(canvas_id, title, chartData){
    var backgroundColors = ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)', 'rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)'];
    var borderColors = ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)', 'rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)'];
    for (var i = 0; i < chartData.datasets.length; i++) {
      chartData.datasets[i].backgroundColor = backgroundColors[i % backgroundColors.length];
      chartData.datasets[i].borderColor = borderColors[i % borderColors.length];
      chartData.datasets[i].borderWidth = 1;
    }
    new Chart($(canvas_id), {
      type: 'bar',
      data: chartData,
      options: {
        indexAxis: 'y',
        elements: {
          bar: {borderWidth: 2}
        },
        responsive: true,
        plugins: {
          legend: {position: 'right'},
          title: {
            display: true,
            text: title
          }
        },
        scales: {
          yAxis: {stacked: true},
          xAxis: {stacked: true}
        }
      }
    });
  }
  $(document).ready(function(){
    var chartData1 = {
      labels: <%= raw rows.collect{|row| row.name}.to_json %>,
      datasets: [{"label":"작성한 댓글 수", "data":<%= raw rows.collect{|row| aggregate(data, {field_name => row.id})}.to_json %> }]
    };
    renderChart("#issues_by_<%= params[:detail] %>", "<%= l(:label_issues_by, @report_title) %>", chartData1);
  });
<% end %>
<% content_for :header_tags do %>
  <%= javascript_include_tag "chart.min" %>
<% end %>
<% end %>
